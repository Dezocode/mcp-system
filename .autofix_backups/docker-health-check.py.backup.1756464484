#!/usr/bin/env python3
"""
Docker Health Check Script
Simple health check script for Docker containers running MCP servers.
"""

import json
import sys
import time
from pathlib import Path


def main():
    """Main health check function"""
    try:
        # Add src to path
        sys.path.insert(0, str(Path(__file__).parent.parent / "src"))

        # Import and run health check
        from config.config_manager import config_manager
        from docker.health_check import docker_health_check

        # Set config manager for health check
        docker_health_check.config_manager = config_manager

        # Perform health check
        response = docker_health_check.get_health_check_endpoint_response()

        # Print JSON response
        print(json.dumps(response, indent=2))

        # Exit with appropriate code
        if response["status"] == "healthy":
            sys.exit(0)
        elif response["status"] == "degraded":
            sys.exit(1)  # Warning state
        else:
            sys.exit(2)  # Critical state
    except Exception as e:
        # Health check itself failed
        error_response = {
            "status": "unhealthy",
            "timestamp": time.time(),
            "message": f"Health check failed: {str(e)}",
            "duration_ms": 0,
        }
        print(json.dumps(error_response, indent=2))
        sys.exit(2)


if __name__ == "__main__":
    main()
